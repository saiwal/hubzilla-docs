<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Hub snapshots - Hubzilla Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/version-select.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Hubzilla Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../start/" class="nav-link">Getting started</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../member/" class="nav-link">Member Guide</a>
                            </li>
                            <li class="nav-item">
                                <a href="../" class="nav-link">Admin Gudie</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../dev/*" class="nav-link">None</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../api/" class="nav-link">API</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/saiwal/hubzilla-docs/edit/master/docs/admin/hub_snapshots.md" class="nav-link">Edit on saiwal/hubzilla-docs
                                    </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            
            
            
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h3 id="hub-snapshot-tools">Hub Snapshot Tools</h3>
<p>Hubzilla developers frequently need to switch between branches that might have 
incompatible database schemas or content. The following two scripts create and 
restore complete snapshots of a Hubzilla instance, including both the hub web 
root and the entire database state. Each script requires a config file called 
<code>hub-snapshot.conf</code> residing in the same folder and containing the specific 
directories and database details of your hub.</p>
<h3 id="config">Config</h3>
<p>The format of the config file is very strict. There must be no spaces between the 
variable name and the value. Replace only the content inside the quotes with your 
configuration. Save this file as <code>hub-snapshot.conf</code> alongside the scripts.</p>
<div class="language-text highlight"><pre><span></span><code># Location of hub root. Typically this is the location of the Hubzilla repo clone.
HUBROOT=&quot;/var/www/&quot;
# MySQL database name
DBNAME=&quot;hubzilla&quot;
# MySQL database user
DBUSER=&quot;hubzilla&quot;
# MySQL database password
DBPWD=&quot;akeufajeuwfb&quot;
# The target snapshot folder where the git repo will be initialized
SNAPSHOTROOT=&quot;/root/snapshots/hubzilla/&quot;
</code></pre></div>
<h3 id="snapshot">Snapshot</h3>
<p>Example usage:</p>
<div class="language-text highlight"><pre><span></span><code>sh hub-snapshot.sh my-hub.conf &quot;Commit message for the snapshot&quot;
</code></pre></div>
<p><strong>hub-snapshot.sh</strong>:</p>
<div class="language-text highlight"><pre><span></span><code>#!/bin/bash

if ! [ -f &quot;$1&quot; ]; then
    echo &quot;$1 is not a valid file. Aborting...&quot;
    exit 1
fi
source &quot;$1&quot;
#echo &quot;$DBNAME&quot;
#echo &quot;$DBUSER&quot;
#echo &quot;$DBPWD&quot;
#echo &quot;$HUBROOT&quot;
#echo &quot;$SNAPSHOTROOT&quot;
MESSAGE=&quot;snapshot: $2&quot;

if [ &quot;$DBPWD&quot; == &quot;&quot; -o &quot;$SNAPSHOTROOT&quot; == &quot;&quot; -o &quot;$DBNAME&quot; == &quot;&quot; -o &quot;$DBUSER&quot; == &quot;&quot; -o &quot;$HUBROOT&quot; == &quot;&quot; ]; then
    echo &quot;Required variable is not set. Aborting...&quot;
    exit 1
fi

if [ ! -d &quot;$SNAPSHOTROOT&quot;/db/ ]; then
    mkdir -p &quot;$SNAPSHOTROOT&quot;/db/
fi
if [ ! -d &quot;$SNAPSHOTROOT&quot;/www/ ]; then
    mkdir -p &quot;$SNAPSHOTROOT&quot;/www/
fi

if [ ! -d &quot;$SNAPSHOTROOT&quot;/www/ ] || [ ! -d &quot;$SNAPSHOTROOT&quot;/db/ ]; then
    echo &quot;Error creating snapshot directories. Aborting...&quot;
    exit 1
fi

echo &quot;Export database...&quot;
mysqldump -u &quot;$DBUSER&quot; -p&quot;$DBPWD&quot; &quot;$DBNAME&quot; &gt; &quot;$SNAPSHOTROOT&quot;/db/&quot;$DBNAME&quot;.sql
echo &quot;Copy hub root files...&quot;
rsync -va --delete --exclude=.git* &quot;$HUBROOT&quot;/ &quot;$SNAPSHOTROOT&quot;/www/

cd &quot;$SNAPSHOTROOT&quot;

if [ ! -d &quot;.git&quot; ]; then
    git init
fi
if [ ! -d &quot;.git&quot; ]; then
    echo &quot;Cannot initialize git repo. Aborting...&quot;
    exit 1
fi

git add -A
echo &quot;Commit hub snapshot...&quot;
git commit -a -m &quot;$MESSAGE&quot;

exit 0
</code></pre></div>
<h3 id="restore">Restore</h3>
<div class="language-text highlight"><pre><span></span><code>#!/bin/bash
# Restore hub to a previous state. Input hub config and commit hash

if ! [ -f &quot;$1&quot; ]; then
        echo &quot;$1 is not a valid file. Aborting...&quot;
        exit 1
fi
source &quot;$1&quot;
COMMIT=$2

if [ &quot;$DBPWD&quot; == &quot;&quot; -o &quot;$SNAPSHOTROOT&quot; == &quot;&quot; -o &quot;$DBNAME&quot; == &quot;&quot; -o &quot;$DBUSER&quot; == &quot;&quot; -o &quot;$HUBROOT&quot; == &quot;&quot; ]; then
        echo &quot;Required variable is not set. Aborting...&quot;
        exit 1
fi
RESTOREDIR=&quot;$(mktemp -d)/&quot;

if [ ! -d &quot;$RESTOREDIR&quot; ]; then
    echo &quot;Cannot create restore directory. Aborting...&quot;
    exit 1
fi
echo &quot;Cloning the snapshot repo...&quot;
git clone &quot;$SNAPSHOTROOT&quot; &quot;$RESTOREDIR&quot;
cd &quot;$RESTOREDIR&quot;
echo &quot;Checkout requested snapshot...&quot;
git checkout &quot;$COMMIT&quot;
echo &quot;Restore hub root files...&quot;
rsync -a --delete --exclude=.git* &quot;$RESTOREDIR&quot;/www/ &quot;$HUBROOT&quot;/
echo &quot;Restore hub database...&quot;
mysql -u &quot;$DBUSER&quot; -p&quot;$DBPWD&quot; &quot;$DBNAME&quot; &lt; &quot;$RESTOREDIR&quot;/db/&quot;$DBNAME&quot;.sql

chown -R www-data:www-data &quot;$HUBROOT&quot;/{store,extend,addon,.htlog,.htconfig.php}

echo &quot;Restored hub to snapshot $COMMIT&quot;
echo &quot;Removing temporary files...&quot;

rm -rf &quot;$RESTOREDIR&quot;

exit 0
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>
        <script src="../../js/version-select.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
